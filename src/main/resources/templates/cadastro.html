<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Cadastro de Clientes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .form-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 1px solid #e9ecef;
        }

        .form-section h2 {
            color: #495057;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin-right: 15px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .clients-section {
            margin-top: 40px;
        }

        .clients-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .clients-table th {
            background: #495057;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .clients-table td {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .clients-table tr:hover {
            background: #f8f9fa;
        }

        .status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .cep-info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            display: none;
        }

        .cep-info h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .cep-info p {
            margin: 5px 0;
            color: #424242;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .content {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¢ Sistema de Cadastro de Clientes</h1>
            <p>Gerenciamento completo com padr√µes de projeto implementados</p>
        </div>

        <div class="content">
            <!-- Alertas -->
            <div id="alertSuccess" class="alert alert-success"></div>
            <div id="alertError" class="alert alert-error"></div>

            <!-- Formul√°rio de Cadastro -->
            <div class="form-section">
                <h2>üìù Cadastrar Novo Cliente</h2>
                <form id="clienteForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="nome">Nome Completo *</label>
                            <input type="text" id="nome" name="nome" required placeholder="Digite o nome completo">
                        </div>
                        <div class="form-group">
                            <label for="cep">CEP *</label>
                            <input type="text" id="cep" name="cep" required placeholder="00000-000" maxlength="9">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="logradouro">Logradouro</label>
                            <input type="text" id="logradouro" name="logradouro" placeholder="Rua, Avenida, etc.">
                        </div>
                        <div class="form-group">
                            <label for="bairro">Bairro</label>
                            <input type="text" id="bairro" name="bairro" placeholder="Nome do bairro">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="cidade">Cidade</label>
                            <input type="text" id="cidade" name="cidade" placeholder="Nome da cidade">
                        </div>
                        <div class="form-group">
                            <label for="uf">Estado</label>
                            <select id="uf" name="uf">
                                <option value="">Selecione...</option>
                                <option value="AC">Acre</option>
                                <option value="AL">Alagoas</option>
                                <option value="AP">Amap√°</option>
                                <option value="AM">Amazonas</option>
                                <option value="BA">Bahia</option>
                                <option value="CE">Cear√°</option>
                                <option value="DF">Distrito Federal</option>
                                <option value="ES">Esp√≠rito Santo</option>
                                <option value="GO">Goi√°s</option>
                                <option value="MA">Maranh√£o</option>
                                <option value="MT">Mato Grosso</option>
                                <option value="MS">Mato Grosso do Sul</option>
                                <option value="MG">Minas Gerais</option>
                                <option value="PA">Par√°</option>
                                <option value="PB">Para√≠ba</option>
                                <option value="PR">Paran√°</option>
                                <option value="PE">Pernambuco</option>
                                <option value="PI">Piau√≠</option>
                                <option value="RJ">Rio de Janeiro</option>
                                <option value="RN">Rio Grande do Norte</option>
                                <option value="RS">Rio Grande do Sul</option>
                                <option value="RO">Rond√¥nia</option>
                                <option value="RR">Roraima</option>
                                <option value="SC">Santa Catarina</option>
                                <option value="SP">S√£o Paulo</option>
                                <option value="SE">Sergipe</option>
                                <option value="TO">Tocantins</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="complemento">Complemento</label>
                        <input type="text" id="complemento" name="complemento" placeholder="Apartamento, bloco, etc.">
                    </div>

                    <!-- Informa√ß√µes do CEP -->
                    <div id="cepInfo" class="cep-info">
                        <h4>üìç Informa√ß√µes do CEP</h4>
                        <p><strong>Logradouro:</strong> <span id="cepLogradouro"></span></p>
                        <p><strong>Bairro:</strong> <span id="cepBairro"></span></p>
                        <p><strong>Cidade:</strong> <span id="cepCidade"></span></p>
                        <p><strong>Estado:</strong> <span id="cepUf"></span></p>
                    </div>

                    <div style="margin-top: 20px;">
                        <button type="submit" class="btn btn-success">‚úÖ Cadastrar Cliente</button>
                        <button type="button" class="btn btn-secondary" onclick="limparFormulario()">üîÑ Limpar</button>
                        <button type="button" class="btn btn-warning" onclick="buscarCep()">üîç Buscar CEP</button>
                    </div>
                </form>
            </div>

            <!-- Loading -->
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>Processando...</p>
            </div>

            <!-- Lista de Clientes -->
            <div class="clients-section">
                <h2>üë• Clientes Cadastrados</h2>
                <button class="btn btn-secondary" onclick="carregarClientes()">üîÑ Atualizar Lista</button>
                <div style="margin-top: 20px;">
                    <table class="clients-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>CEP</th>
                                <th>Endere√ßo</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="clientesTableBody">
                            <tr>
                                <td colspan="5" style="text-align: center; color: #6c757d;">
                                    Nenhum cliente cadastrado ainda
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Se√ß√£o de Notifica√ß√µes -->
            <div class="clients-section">
                <h2>üîî Notifica√ß√µes do Sistema</h2>
                <button class="btn btn-secondary" onclick="carregarNotificacoes()">üîÑ Atualizar Notifica√ß√µes</button>
                <div style="margin-top: 20px;">
                    <table class="clients-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Mensagem</th>
                                <th>Tipo</th>
                                <th>Cliente</th>
                                <th>Data</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="notificacoesTableBody">
                            <tr>
                                <td colspan="6" style="text-align: center; color: #6c757d;">
                                    Nenhuma notifica√ß√£o encontrada
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configura√ß√µes da API
        const API_BASE = 'http://localhost:8081';
        
        // Elementos do DOM
        const clienteForm = document.getElementById('clienteForm');
        const loading = document.getElementById('loading');
        const alertSuccess = document.getElementById('alertSuccess');
        const alertError = document.getElementById('alertError');
        const cepInfo = document.getElementById('cepInfo');

        // M√°scara para CEP
        document.getElementById('cep').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 5) {
                value = value.substring(0, 5) + '-' + value.substring(5, 8);
            }
            e.target.value = value;
        });

        // Buscar informa√ß√µes do CEP
        async function buscarCep() {
            const cep = document.getElementById('cep').value.replace(/\D/g, '');
            if (cep.length !== 8) {
                mostrarAlerta('Por favor, digite um CEP v√°lido com 8 d√≠gitos', 'error');
                return;
            }

            mostrarLoading(true);
            try {
                const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
                const data = await response.json();
                
                if (data.erro) {
                    mostrarAlerta('CEP n√£o encontrado', 'error');
                    return;
                }

                // Preencher campos com dados do CEP
                document.getElementById('logradouro').value = data.logradouro || '';
                document.getElementById('bairro').value = data.bairro || '';
                document.getElementById('cidade').value = data.localidade || '';
                document.getElementById('uf').value = data.uf || '';

                // Mostrar informa√ß√µes do CEP
                document.getElementById('cepLogradouro').textContent = data.logradouro || 'N√£o informado';
                document.getElementById('cepBairro').textContent = data.bairro || 'N√£o informado';
                document.getElementById('cepCidade').textContent = data.localidade || 'N√£o informado';
                document.getElementById('cepUf').textContent = data.uf || 'N√£o informado';
                
                cepInfo.style.display = 'block';
                mostrarAlerta('CEP encontrado e campos preenchidos automaticamente!', 'success');
            } catch (error) {
                mostrarAlerta('Erro ao buscar CEP: ' + error.message, 'error');
            } finally {
                mostrarLoading(false);
            }
        }

        // Cadastrar cliente
        clienteForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(clienteForm);
            const cliente = {
                nome: formData.get('nome'),
                endereco: {
                    cep: formData.get('cep').replace(/\D/g, ''),
                    logradouro: formData.get('logradouro'),
                    complemento: formData.get('complemento'),
                    bairro: formData.get('bairro'),
                    localidade: formData.get('cidade'),
                    uf: formData.get('uf')
                }
            };

            if (!cliente.nome || !cliente.endereco.cep) {
                mostrarAlerta('Nome e CEP s√£o obrigat√≥rios', 'error');
                return;
            }

            mostrarLoading(true);
            try {
                const response = await fetch(`${API_BASE}/clientes`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(cliente)
                });

                if (response.ok) {
                    const clienteCriado = await response.json();
                    mostrarAlerta(`Cliente ${clienteCriado.nome} cadastrado com sucesso! ID: ${clienteCriado.id}`, 'success');
                    limparFormulario();
                    carregarClientes();
                    carregarNotificacoes();
                } else {
                    const error = await response.text();
                    mostrarAlerta('Erro ao cadastrar cliente: ' + error, 'error');
                }
            } catch (error) {
                mostrarAlerta('Erro de conex√£o: ' + error.message, 'error');
            } finally {
                mostrarLoading(false);
            }
        });

        // Carregar clientes
        async function carregarClientes() {
            mostrarLoading(true);
            try {
                const response = await fetch(`${API_BASE}/clientes`);
                if (response.ok) {
                    const clientes = await response.json();
                    const tbody = document.getElementById('clientesTableBody');
                    
                    if (clientes.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #6c757d;">Nenhum cliente cadastrado ainda</td></tr>';
                        return;
                    }

                    tbody.innerHTML = clientes.map(cliente => `
                        <tr>
                            <td>${cliente.id}</td>
                            <td>${cliente.nome}</td>
                            <td>${cliente.endereco.cep}</td>
                            <td>${cliente.endereco.logradouro}, ${cliente.endereco.bairro}, ${cliente.endereco.localidade}/${cliente.endereco.uf}</td>
                            <td>
                                <button class="btn btn-warning" onclick="editarCliente(${cliente.id})">‚úèÔ∏è</button>
                                <button class="btn btn-danger" onclick="deletarCliente(${cliente.id})">üóëÔ∏è</button>
                            </td>
                        </tr>
                    `).join('');
                } else {
                    mostrarAlerta('Erro ao carregar clientes', 'error');
                }
            } catch (error) {
                mostrarAlerta('Erro de conex√£o: ' + error.message, 'error');
            } finally {
                mostrarLoading(false);
            }
        }

        // Carregar notifica√ß√µes
        async function carregarNotificacoes() {
            mostrarLoading(true);
            try {
                const response = await fetch(`${API_BASE}/notificacoes`);
                if (response.ok) {
                    const notificacoes = await response.json();
                    const tbody = document.getElementById('notificacoesTableBody');
                    
                    if (notificacoes.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #6c757d;">Nenhuma notifica√ß√£o encontrada</td></tr>';
                        return;
                    }

                    tbody.innerHTML = notificacoes.map(notif => `
                        <tr>
                            <td>${notif.id}</td>
                            <td>${notif.mensagem}</td>
                            <td><span class="status ${notif.tipo.toLowerCase()}">${notif.tipo}</span></td>
                            <td>${notif.cliente ? notif.cliente.nome : 'N/A'}</td>
                            <td>${new Date(notif.dataEnvio).toLocaleString('pt-BR')}</td>
                            <td><span class="status ${notif.enviada ? 'success' : 'error'}">${notif.enviada ? 'Enviada' : 'Pendente'}</span></td>
                        </tr>
                    `).join('');
                } else {
                    mostrarAlerta('Erro ao carregar notifica√ß√µes', 'error');
                }
            } catch (error) {
                mostrarAlerta('Erro de conex√£o: ' + error.message, 'error');
            } finally {
                mostrarLoading(false);
            }
        }

        // Deletar cliente
        async function deletarCliente(id) {
            if (!confirm('Tem certeza que deseja deletar este cliente?')) return;
            
            mostrarLoading(true);
            try {
                const response = await fetch(`${API_BASE}/clientes/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    mostrarAlerta('Cliente deletado com sucesso!', 'success');
                    carregarClientes();
                    carregarNotificacoes();
                } else {
                    mostrarAlerta('Erro ao deletar cliente', 'error');
                }
            } catch (error) {
                mostrarAlerta('Erro de conex√£o: ' + error.message, 'error');
            } finally {
                mostrarLoading(false);
            }
        }

        // Editar cliente (placeholder)
        function editarCliente(id) {
            alert('Funcionalidade de edi√ß√£o ser√° implementada em breve!');
        }

        // Limpar formul√°rio
        function limparFormulario() {
            clienteForm.reset();
            cepInfo.style.display = 'none';
            ocultarAlertas();
        }

        // Fun√ß√µes auxiliares
        function mostrarLoading(show) {
            loading.style.display = show ? 'block' : 'none';
        }

        function mostrarAlerta(mensagem, tipo) {
            ocultarAlertas();
            const alert = tipo === 'success' ? alertSuccess : alertError;
            alert.textContent = mensagem;
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }

        function ocultarAlertas() {
            alertSuccess.style.display = 'none';
            alertError.style.display = 'none';
        }

        // Carregar dados ao iniciar a p√°gina
        window.addEventListener('load', function() {
            carregarClientes();
            carregarNotificacoes();
        });
    </script>
</body>
</html>
